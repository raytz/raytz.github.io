# 1. 服务网关/网桥的概念

# 2. 网关分层
1. 基础功能：路由、发布策略
2. 辅助功能：黑名单、认证、计费、业务监控
3. 服务治理：限流、降级、监控统计、熔断、负载均衡
4. 运维层：集群部署、自动扩缩、故障转移

### 2.1. 发布策略
#### 2.1.1. 蓝绿发布 
主备的概念，多版本同时并存，但只有主机有流量，发布时备机更新新版本，主备切换。
优势：简单，易用。发布时将备机升级到新版本，测试完成后，将备机升级为主机，将原主机降级成备机。回滚时主备进行切换即可。适合业务明确的小集群，小项目。
缺点：所有环境复制多份，特别是DB的复制。完全不适用于微服务集群，调用路径不确定的情况太多。

#### 2.1.2. 灰度发布/金丝雀发布
旧版本里夹带一个新版本，用于发现问题。使用升级其中一个负载，负责一部分用户流量，用于观察服务的情况。如果正常，继续发布第二台负载。
优势：节省资源，用户感知小，主要用于控制风险、测试兼容性
缺点：虽然感知小，但还是有感知，用户人群不确定。

#### 2.1.3. A/B Testing
根据用户样本、比如ip段，手机号等信息，拆分人群，进行验证。
优势：目标人群确定，不会影响意料之外的用户。
缺点：功能可能覆盖不全，目标人群可能不能使用上每一个功能，AB阶段可能没有问题，但到了实际应用场景还是有问题。

PS：ABTesting的目标人群需要具体一定代表性，才能更反应业务问题，选取目标人群就需要有算法和策略，这个需要平时进行分析和收集。

### 2.2. 负载均衡
Ribbon是Netflix公司开源的一个负载均衡的项目，由客户端进行负载均衡，主要功能

* 负载均衡
* 容错
* 多协议（HTTP、TCP、UDP）支持异步和Reactor
* 缓存和批处理

Eureka是Netflix开源的一款提供服务注册和发现的产品，它提供了完整的Service Registry和Service Discovery实现。也是springcloud体系中最重要最核心的组件之一。



### 2.3. 熔断器
Hystrix

### 2.4. 限流
Bucket4j

### 2.5. 监控
kafka上报、分析

### 2.6. 故障转移
erueka
consul


#参考资料
<a href=https://mp.weixin.qq.com/s/FxEH82B7d9y762SI5DSBpA>一个可快速落地的微服务网关架构实现</a>


<a href=https://www.v2ex.com/t/344341>
蓝绿部署、A/B 测试以及灰度发布</a>